<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Médico - Medfy</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-plus"></i>
                    </div>
                    <span class="logo-text">Medfy</span>
                </div>
                <button class="sidebar-toggle">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            <nav class="sidebar-nav">
                <a href="index.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="pacientes.html" class="nav-item">
                    <i class="fas fa-users"></i>
                    <span>Pacientes</span>
                </a>
                    <a href="{{ url_for('view_medico') }}" class="nav-item active">
                        <i class="fas fa-user-md"></i>
                        <span>Médicos</span>
                    </a>
                <a href="convenios.html" class="nav-item">
                    <i class="fas fa-id-card"></i>
                    <span>Convênios</span>
                </a>
                <a href="{{ url_for('agendamentos') }}" class="nav-item">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Agendamentos</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <button class="menu-button">
                    <i class="fas fa-bars"></i>
                    <span>Menu</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                <h1 class="page-title">Cadastro de Médico</h1>
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="search" placeholder="Buscar...">
                </div>
                <div class="header-actions">
                    <button class="icon-button">
                        <i class="fas fa-bell"></i>
                    </button>
                    <button class="icon-button">
                        <i class="fas fa-cog"></i>
                    </button>
                    <div class="avatar">
                        <span>AD</span>
                    </div>
                </div>
            </header>

            <!-- Main -->
            <main class="content">
                <div class="page-header">
                    <div class="back-button-container">
                        <a href="medicos.html" class="btn btn-icon">
                            <i class="fas fa-arrow-left"></i>
                        </a>
                        <h1 class="page-title">Cadastro de Médico</h1>
                    </div>
                </div>

                <form class="form-container">
                    <!-- Informações Profissionais -->
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <h2 class="card-title">Informações Profissionais</h2>
                                <p class="card-description">Preencha os dados profissionais do médico</p>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="nome">Nome Completo</label>
                                    <input type="text" id="nome" name="nome" required>
                                </div>
                                <div class="form-group">
                                    <label for="especialidade">Especialidade</label>
                                    <select id="especialidade" name="especialidade" required>
                                        <option value="" disabled selected>Selecione uma especialidade</option>
                                        <option value="cardiologia">Cardiologia</option>
                                        <option value="dermatologia">Dermatologia</option>
                                        <option value="endocrinologia">Endocrinologia</option>
                                        <option value="gastroenterologia">Gastroenterologia</option>
                                        <option value="geriatria">Geriatria</option>
                                        <option value="ginecologia">Ginecologia</option>
                                        <option value="neurologia">Neurologia</option>
                                        <option value="oftalmologia">Oftalmologia</option>
                                        <option value="ortopedia">Ortopedia</option>
                                        <option value="otorrinolaringologia">Otorrinolaringologia</option>
                                        <option value="pediatria">Pediatria</option>
                                        <option value="psiquiatria">Psiquiatria</option>
                                        <option value="urologia">Urologia</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="crm">CRM</label>
                                    <input type="text" id="crm" name="crm" placeholder="00000-UF" required>
                                </div>
                                <div class="form-group">
                                    <label for="turno">Turno de Trabalho</label>
                                    <select id="turno" name="turno" required>
                                        <option value="" disabled selected>Selecione um turno</option>
                                        <option value="manha">Manhã</option>
                                        <option value="tarde">Tarde</option>
                                        <option value="noite">Noite</option>
                                        <option value="integral">Integral</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="telefone">Telefone</label>
                                    <input type="text" id="telefone" name="telefone" placeholder="(00) 00000-0000" required>
                                </div>
                                <div class="form-group">
                                    <label for="email">Email</label>
                                    <input type="email" id="email" name="email" placeholder="exemplo@email.com" required>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <a href="medicos.html" class="btn btn-outline">Cancelar</a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Salvar Médico
                            </button>
                        </div>
                    </div>
                </form>
            </main>
        </div>
    </div>

    <script>
       // cadastro_medico.js

document.addEventListener('DOMContentLoaded', function() {
    // Máscara para telefone
    const telefoneInput = document.getElementById('telefone');
    telefoneInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');

        if (value.length > 11) {
            value = value.substring(0, 11);
        }

        // Formatação para (00) 00000-0000 ou (00) 0000-0000
        if (value.length > 2) {
            value = `(${value.substring(0, 2)}) ${value.substring(2)}`;
        }
        if (value.length > 10) {
            value = `${value.substring(0, 10)}-${value.substring(10)}`;
        }

        e.target.value = value;
    });

    // Máscara para CRM (00000-UF)
    const crmInput = document.getElementById('crm');
    crmInput.addEventListener('input', function(e) {
        let value = e.target.value.toUpperCase();

        // Remove tudo que não for letra, número ou hífen
        value = value.replace(/[^A-Z0-9-]/g, '');

        // Garante o formato 00000-UF
        if (value.length > 5 && !value.includes('-')) {
            value = `${value.substring(0, 5)}-${value.substring(5)}`;
        }

        // Limita a 8 caracteres (5 números + hífen + 2 letras)
        if (value.length > 8) {
            value = value.substring(0, 8);
        }

        e.target.value = value;
    });

    // Validação do formulário
    const form = document.querySelector('.form-container');
    form.addEventListener('submit', async function(e) {
        e.preventDefault();

        // Validação dos campos
        if (!validarFormulario()) {
            return;
        }

        // Mostrar loading no botão
        const submitButton = form.querySelector('button[type="submit"]');
        const originalButtonText = submitButton.innerHTML;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
        submitButton.disabled = true;

        try {
            // Preparar dados para envio
            const medicoData = {
                nome_med: document.getElementById('nome').value.trim(),
                especialidade: document.getElementById('especialidade').value,
                crm: document.getElementById('crm').value.trim(),
                turno: document.getElementById('turno').value,
                telefone: document.getElementById('telefone').value.replace(/\D/g, ''),
                email_med: document.getElementById('email').value.trim()
            };

            // Enviar para a API
            const response = await fetch('/medico/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(medicoData)
            });

            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.error || 'Erro ao cadastrar médico');
            }

            // Sucesso - redirecionar ou mostrar mensagem
            alert('Médico cadastrado com sucesso!');
            window.location.href = '/view/medico'; // Redireciona para a lista de médicos

        } catch (error) {
            console.error('Erro:', error);
            alert(`Erro ao cadastrar médico: ${error.message}`);
        } finally {
            // Restaurar botão
            submitButton.innerHTML = originalButtonText;
            submitButton.disabled = false;
        }
    });

    // Função de validação do formulário
    function validarFormulario() {
        let isValid = true;

        // Validação do nome
        const nome = document.getElementById('nome').value.trim();
        if (nome.length < 3) {
            alert('Por favor, insira um nome válido (mínimo 3 caracteres)');
            isValid = false;
        }

        // Validação da especialidade
        const especialidade = document.getElementById('especialidade').value;
        if (!especialidade) {
            alert('Por favor, selecione uma especialidade');
            isValid = false;
        }

        // Validação do CRM (formato 00000-UF)
        const crm = document.getElementById('crm').value.trim();
        const crmRegex = /^\d{5}-[A-Z]{2}$/;
        if (!crmRegex.test(crm)) {
            alert('Por favor, insira um CRM válido no formato 00000-UF');
            isValid = false;
        }

        // Validação do turno
        const turno = document.getElementById('turno').value;
        if (!turno) {
            alert('Por favor, selecione um turno de trabalho');
            isValid = false;
        }

        // Validação do telefone (mínimo 10 dígitos)
        const telefone = document.getElementById('telefone').value.replace(/\D/g, '');
        if (telefone.length < 10) {
            alert('Por favor, insira um telefone válido');
            isValid = false;
        }

        // Validação do email
        const email = document.getElementById('email').value.trim();
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            alert('Por favor, insira um email válido');
            isValid = false;
        }

        return isValid;
    }

    // Toggle sidebar
    document.querySelector('.sidebar-toggle').addEventListener('click', function() {
        document.querySelector('.sidebar').classList.toggle('collapsed');
        document.querySelector('.main-content').classList.toggle('expanded');
    });

    document.querySelectorAll('a[href="index.html"]').forEach(link => {
        link.href = "{{ url_for('index_page') }}";
    });
    document.querySelectorAll('a[href="pacientes.html"]').forEach(link => {
        link.href = "{{ url_for('view_paciente') }}";
    });
    document.querySelectorAll('a[href="medicos.html"]').forEach(link => {
        link.href = "{{ url_for('view_medico') }}";
    });
});
    </script>

</body>
</html>
